<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
    crossorigin="anonymous"></script>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proektna</title>
  <style>
    body{
	background-color: hsl(0, 0%, 98%);
}

h1,h2,h3,h4,h5,h6{
	color:hsl(0, 0%, 30%);
}

.box-element{
	box-shadow:hsl(0, 0%, 80%) 0 0 16px;
	background-color: #fff;
	border-radius: 4px;
	padding: 10px;
}

.thumbnail{
	width: 100%;
	height: 200px;
	-webkit-box-shadow: -1px -3px 5px -2px rgba(214,214,214,1);
    -moz-box-shadow: -1px -3px 5px -2px rgba(214,214,214,1);
    box-shadow: -1px -3px 5px -2px rgba(214,214,214,1);
}

.product{
	border-radius: 0 0 4px 4px;
}

#cart-icon{
	width:25px;
	display: inline-block;
	margin-left: 10px;
    margin-right: 10px;
}

#cart-total{
	display: block;
	text-align: center;
	color:#fff;
	background-color: red;
	width: 20px;
	height: 25px;
	border-radius: 50%;
	font-size: 14px;
    margin-left: -200px;
    margin-top: -45px;
}

.col-lg-4, .col-lg-6, .col-lg-8, .col-lg-12{
	margin-top: 10px;
}

.btn{
	border-radius: 0;
}

.row-image{
	width: 100px;
}

.form-field{
	width:250px;
	display: inline-block;
	padding: 5px;
}

.cart-row{
	display: flex;
    align-items: flex-stretch;
    padding-bottom: 10px;
    margin-bottom: 10px;
    border-bottom: 1px solid #ececec;

}

.quantity{
	display: inline-block;
	font-weight: 700;
	padding-right:10px;
	

}

.chg-quantity{
	width: 12px;
	cursor: pointer;
	display: block;
	margin-top: 5px;
	transition:.1s;
}

.chg-quantity:hover{
	opacity: .6;
}


.hidden{
	display: none!important;
}
/* Add a black background color to the top navigation bar */
.topnav {
	overflow: hidden;
	background-color: #e9e9e9;
  }
  
  /* Style the links inside the navigation bar */
  .topnav a {
	float: left;
	display: block;
	color: black;
	text-align: center;
	padding: 14px 16px;
	text-decoration: none;
	font-size: 17px;
  }
  
  /* Change the color of links on hover */
  .topnav a:hover {
	background-color: #ddd;
	color: black;
  }
  
  /* Style the "active" element to highlight the current page */
  .topnav a.active {
	background-color: #2196F3;
	color: white;
  }
  
  /* Style the search box inside the navigation bar */
  .topnav input[type=text] {
	float: right;
	padding: 6px;
	border: none;
	margin-top: 8px;
	margin-right: 16px;
	font-size: 17px;
  }
  
  /* When the screen is less than 600px wide, stack the links and the search field vertically instead of horizontally */
  @media screen and (max-width: 600px) {
	.topnav a, .topnav input[type=text] {
	  float: none;
	  display: block;
	  text-align: left;
	  width: 100%;
	  margin: 0;
	  padding: 14px;
	}
	.topnav input[type=text] {
	  border: 1px solid #ccc;
	}
  }
  .nav-background {
	background-image: url("images/pozadina.jpg");
	background-size: cover;

	/* Workaround for some mobile browsers */
	min-height: 100%;
  }
  </style>
  <script type="text/javascript">
    var user = '{{request.user}}'

    function getToken(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          // Does this cookie string begin with the name we want?
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
    var csrftoken = getToken('csrftoken');
  </script>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-black">
    <div class="container-fluid">
      <a class="navbar-brand" href="{% url 'store' %}"><img src="images/sportfusion.png"
          style="width: 300px; margin-top: -300px;" alt=""></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <img src="images/pozadina.jpg" alt="" style="position: static;">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active " aria-current="page"
              style="font-weight: bold; margin-left: -550px;margin-top: -170px;" href="{% url 'products' %}">СИТЕ
              ПРОДУКТИ</a>
          </li>
          <li class="nav-item">
            <form class="form-inline">
              <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search"
                style="margin-top: -170px;">
            </form>
          </li>
          <!-- <li class="nav-item">
            <div class="form-inline my-2 my-lg-0 " style="margin-left: 400px;">
              <p class="text-white" style="font-weight: bold;margin-top:0px;margin-left: -1500px; font-size:xx-large;">ИГРАЈ
                КАКО <span class="text-danger">ШАМПИОН</span></p>
              {%if user.is_authenticated%}
              <a class="btn btn-danger" style="border-radius: 10%; margin-top: -450px;"
                href="{% url 'profile' %}">Profile</a>
              <a class="btn btn-danger" style="border-radius: 10%; margin-top: -450px;" href="{% url 'logout' %}">Logout</a>
              <a href="{% url 'cart' %}"> <img id="cart-icon" src="{% static 'images/cart.png' %}"
                  style="margin-top: -450px;"></a>
              <p id="cart-total" style="margin-left: 190px; margin-top: -270px;">{{cartItems}}</p>
              {% else %}
              <a class="btn btn-danger" style="border-radius: 10%; margin-top: -360px;" href="{% url 'login' %}">Login</a>
              <a class="btn btn-danger" style="border-radius: 10%; margin-top: -360px;"
                href="{% url 'register' %}">Register</a>
              {% endif %}
              {% if user.is_superuser %}
    
              <a href="{% url 'product-create' %}"> <img src="images/plus.png"
                  style="width: 30px; margin-top: 25px; margin-left: 165px;" alt=""></a>
    
              {% endif %}
            </div>
          </li> -->
        </ul>
        <p style="color: white; margin-top: -270px;">{{request.user.username}}</p>
        <div class="form-inline my-2 my-lg-0">
          <p class="text-white" style="font-weight: bold;margin-top:0px;margin-left: -1500px; font-size:xx-large;">ИГРАЈ
            КАКО <span class="text-danger">ШАМПИОН</span></p>
          {%if user.is_authenticated%}
          <a class="btn btn-danger" style="border-radius: 10%; margin-top: -450px;"
            href="{% url 'profile' %}">Profile</a>
          <a class="btn btn-danger" style="border-radius: 10%; margin-top: -450px;" href="{% url 'logout' %}">Logout</a>
          <a href="{% url 'cart' %}"> <img id="cart-icon" src="{% static 'images/cart.png' %}"
              style="margin-top: -450px;"></a>
          <p id="cart-total" style="margin-left: 190px; margin-top: -270px;">{{cartItems}}</p>
          {% else %}
          <a class="btn btn-danger" style="border-radius: 10%; margin-top: -360px;" href="{% url 'login' %}">Login</a>
          <a class="btn btn-danger" style="border-radius: 10%; margin-top: -360px;"
            href="{% url 'register' %}">Register</a>
          {% endif %}
          {% if user.is_superuser %}

          <a href="{% url 'product-create' %}"> <img src="images/plus.png"
              style="width: 30px; margin-top: 25px; margin-left: 165px;" alt=""></a>

          {% endif %}
        </div>
      </div>
    </div>
  </nav>
  <div class="container">
    <h1 class="text-center">ПОНУДЕНИ ПРОДУКТИ</h1>
    <div class="row">
      {%for product in products%}
      <div class="col-lg-4">
        <div class="row"><img style="width: 400px;" src="{{product.imageURL}}" alt=""></div>
        <h6 style="margin-bottom: 40px;"><strong>{{product.name}}</strong></h6>
      </div>
      <div style=" margin-top: -180px; " class="text-center">
        <a class="btn btn-danger" style="margin-top: 50px;" href="{% url 'product-detail' product.id %}">View</a>
        {% if user.is_superuser%}
        <a class="btn btn-outline-warning" style="margin-left: 0px; margin-top: 50px;"
          href="{% url 'product-delete' product.id %}">Delete</a>
        {% endif %}
      </div>
      <div class="col">
        <div class="row" style="width: 600px; margin-top: -340px; margin-right: -400px; margin-left: 430px;">
          <p style="font-size: larger; font-weight: 500; margin-top: 50px;">{{product.description}}</p>
        </div>
      </div>
      <div>
        <hr style="width: 1000px;">
      </div>
      {%endfor%}
    </div> -->

  </div>
  <script type="text/javascript" > var updateBtns=document.getElementsByClassName('update-cart');
    for(var i=0;i<updateBtns.length;i++){
        updateBtns[i].addEventListener("click",function(){
            var productId=this.dataset.product
            var action=this.dataset.action
            console.log("ProductId: ",productId,"Action: ",action)
    
            console.log("USER:",user)
            if(user==='AnonymousUser'){
                console.log("Not logged in")
            }
            else
            {
                updateUserOrder(productId,action)
            } 
        })
        
    }
    
    function updateUserOrder(productId,action){
        console.log("User is authenticated, sending data..")
    
        var url= '/update_item/'
    
        fetch(url,{
            method:'POST',
            headers:{
                'Content-Type':'application/json',
                'X-CSRFToken':csrftoken,
            },
            body:JSON.stringify({'productId':productId,'action':action})
        })
    
        .then((response)=>{
            return response.json()
        })
    
        .then((data)=>{
            console.log('data:',data)
            location.reload(true)
        })
    }</script>
  <footer>

    <div style="height: 300px;" class="bg-black"></div>
    <h3 style="margin-top: -70px; " class="text-white">191242@design.info</h3>

    <a class="navbar-brand" href="{% url 'store' %}"><img src="images/sportfusion.png"
        style="width: 150px; margin-top: -70px; margin-left: 900px;" alt=""></a>
    <a href="" class="text-white" style=" margin-bottom: 100px; margin-left: 500px; text-decoration: none;">Terms and
      services</a>
    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor"  style="color: white; margin-top: -500px;" class="bi bi-instagram"
      viewBox="0 0 16 16">
      <path
        d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z" />
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-facebook" style="color: white; margin-top: -500px;" viewBox="0 0 16 16">
      <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"/>
    </svg>
  </footer>
</body>

</html>